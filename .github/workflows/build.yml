name: build

on:
    push:
    pull_request:
    workflow_dispatch:

jobs:
    build:
        strategy:
            fail-fast: false
            matrix:
                include:
                    - os: windows-latest
                      target: x86_64-pc-windows-msvc
                      ext: .exe
                    - os: ubuntu-latest
                      target: x86_64-unknown-linux-gnu
                      ext: ""
                    - os: macos-latest
                      target: aarch64-apple-darwin
                      ext: ""

        runs-on: ${{ matrix.os }}

        steps:
            - uses: actions/checkout@v4

            - uses: dtolnay/rust-toolchain@stable
              with:
                  targets: ${{ matrix.target }}

            - uses: Swatinem/rust-cache@v2
              with:
                  workspaces: .

            - name: Build (svza only)
              run: cargo build --release --target ${{ matrix.target }} --bin svza

            - name: Upload artifact (svza only)
              uses: actions/upload-artifact@v4
              with:
                  name: sv2za-${{ matrix.target }}
                  path: target/${{ matrix.target }}/release/svza${{ matrix.ext }}
